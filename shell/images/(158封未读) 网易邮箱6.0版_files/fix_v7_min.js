!function(a){function b(a){switch(a){case"p0":d(),e();break;case"p1":c(),j(),l(),k();break;case"module/compose/composeattach":setTimeout(function(){i(),f(),g(),h()},0);break;case"product/schedule":}}function c(){new $I18N("product.Schedule");var a=$.createClass($N("product.Schedule"));a._parseIcs=function(a){function b(a,b){var e=c(a,b);e.key;var f=e.value,h=e.param;switch(b){case"DTSTART":case"DTEND":var i=d(f,h.VALUE);$.Browser.isIE("<9")&&(i=i.replace(/\-/g,"/").replace(/T/," "));var j=+new Date(i)-("DATE"==h.VALUE&&"DTEND"==b?864e5:0);try{if(h.TZID&&g.timeZone&&g.timeZone[h.TZID.replace(/['"]/g,"")]&&f.indexOf("Z")>-1){var k=g.timeZone[h.TZID.replace(/['"]/g,"")],l=k.match(/([\+\-])(\d{2})(\d{2})/);l&&(j+=("+"==l[1]?-1:1)*(1e3*60*60*+l[2]+1e3*60*+l[3]))}}catch(m){}try{var n=new Intl.DateTimeFormat("cn-ZH",{dateStyle:"short",timeStyle:"medium"}).format(),o=new Intl.DateTimeFormat("cn-ZH",{dateStyle:"short",timeStyle:"medium",timeZone:h.TZID}).format(),p=+new Date(n)-+new Date(o);p&&(j+=p)}catch(m){}return j;case"ORGANIZER":case"ATTENDEE":var q=f.replace(/^mailto:/i,""),r=[h.CN||q,q];return h.PARTSTAT&&r.push(h.PARTSTAT),r.join(":");case"SEQUENCE":case"REPEAT":return+f;default:return f}}function c(a,b){var c=new RegExp(b+"[:;]{1}([\\w\\W]*?)\\n(?!\\s)","i");"ATTENDEE"==b&&(c=new RegExp(b+"[:;]{1}(.+)","i"));var d=a.match(c);if(!d)return{};var e=$.String.decodeHTML(d[0].replace(/[\r\n\t]\ */g,"")),f=e.split(":");if(2>f)return{};var g=f.shift(),h=f.join(":"),i={},j=g.split(";");if(j.length>1)for(var k=1;k<j.length;k++){var l=j[k].split("=");i[l.shift()]=l.join("=")}return{key:g,value:h,param:i}}function d(a,b){if(b=b||"DATE-TIME","DATE"===b)return a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2);if("DATE-TIME"===b){var c=a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2)+"T"+a.substr(9,2)+":"+a.substr(11,2)+":"+a.substr(13,2);return a[15]&&"Z"===a[15]&&(c+="Z"),c}return 0/0}function e(a){for(var b=/([PDWHMTS]{1,1})/,c=0,d={},e=0;-1!==(c=a.search(b));){var g=a[c],h=a.substr(0,c);a=a.substr(c+1),e+=f(g,h,d)}return 2>e?{}:d}function f(a,b,c){var d;switch(a){case"P":c.isNegative=b&&"-"===b?!0:!1;break;case"D":d="days";break;case"W":d="weeks";break;case"H":d="hours";break;case"M":d="minutes";break;case"S":d="seconds";break;default:return 0}if(d){if(!b&&0!==b)throw new Error('invalid duration value: Missing number before "'+a+'"');var e=parseInt(b,10);if(isNaN(e))throw new Error('invalid duration value: Invalid number "'+b+'" before "'+a+'"');c[d]=e}return 1}var g={method:null,veventList:[]};if(!a||"string"!=typeof a)return g;var h=a.match(/BEGIN:VCALENDAR([\w\W]*?)END:VCALENDAR/i);if(!h)return g;var i=h[1];g.method=b(i,"METHOD"),g.timeZone={};try{var j=a.match(/BEGIN:VTIMEZONE([\w\W]*?)END:VTIMEZONE/gi);if(j&&j.length)for(var k=0;k<j.length;k++){sTimeZone=j[0];var l,m=b(sTimeZone,"TZID"),n=sTimeZone.match(/BEGIN:STANDARD([\w\W]*?)END:STANDARD/i);n&&(l=b(n[0],"TZOFFSETTO"));var o=sTimeZone.match(/BEGIN:DAYLIGHT([\w\W]*?)END:DAYLIGHT/i);o&&(l=b(o[0],"TZOFFSETTO")),g.timeZone[m]=l}}catch(p){}var q=a.match(/BEGIN:VEVENT([\w\W]*?)END:VEVENT/gi);if(!q||0===q.length)return g;for(var k=0;k<q.length;k++){var r=q[k],s={};s.method=g.method,s.startTime=b(r,"DTSTART"),s.endTime=b(r,"DTEND"),s.summary=b(r,"SUMMARY"),s.location=b(r,"LOCATION"),s.organizer=b(r,"ORGANIZER"),s.uid=b(r,"UID");var t=b(r,"SEQUENCE");s.sequence=isNaN(t)?-1:t,s.status=b(r,"STATUS");var u=c(r,"DTSTART"),v=c(r,"DTEND");s.allday="DATE"===u.param.VALUE&&"DATE"===v.param.VALUE?1:0,s.attendList=[];var w=r.match(/ATTENDEE[:;]{1}([\w\W]*?)\n(?!\s)/gi);if(w&&w.length)for(var x=0;x<w.length;x++)s.attendList.push(b(w[x].replace(/\s/g,""),"ATTENDEE"));s.valarmList=[];var y=r.match(/BEGIN:VALARM([\w\W]*?)END:VALARM/gi);if(y&&y.length)for(var x=0;x<y.length;x++){var z={action:b(y[x],"ACTION"),trigger:b(y[x],"TRIGGER"),repeat:b(y[x],"REPEAT"),unit:0,interval:0},A=c(r,"TRIGGER");if("DATE-TIME"===A.param.VALUE){var B=d(z.trigger,A.param.VALUE);z.unit=1,z.interval=(s.startTime-+new Date(B))/6e4}else for(var C=e(z.trigger),D=["seconds","minutes","hours","days","weeks"],E=0;E<D.length;E++){var F=D[E];if(F in C){E?(z.unit=E,z.interval=C[F]):(z.unit=1,z.interval=Math.ceil(C[F]/60));break}}s.valarmList.push(z)}g.veventList.push(s)}return g}}function d(){var b=new $I18N("free.config.Topnav"),c=$G.get("topNavConf");c[c.length-1]={name:"upgrade",onRender:function(){function c(c){var e=c["product.vipMember"],f=c["product.plus.memberExpireTime"],g=!1,h=new Date($G.environment.now);h<new Date(2023,0,1,0)&&(g=!0);var i=a.localStorage.getItem("topnav_member_never"),j=!f&&g&&!i;if(j){var k=["._upgrade_member { position: relative; }",'._upgrade_member:after { content: ""; background: url(https://mail-activity.nos-jd.163yun.com/8735be1e77a83b1791ef58122a0aafcd.png) center no-repeat; position: absolute; width: 60px; height: 16px; background-size: 60px; left: 46px; bottom: 22px; }'].join("");$.Support.insertStyle(k,"_upgrade_member")}var l=new $.Link({text:e?b.t("续费"):b.t("开通邮箱会员"),click:function(){try{var b=$L("product.Privileges",this)}catch(c){return c}b.showDialog("plus","","navigation"),$.Log.cache({Topnav20UpgradeVipClick:1}),a.localStorage.setItem("topnav_member_never","1"),this.getDom().classList.remove("_upgrade_member")},extcls:"sh0 nui-txt-link"+(e?"":" sX1")+(j?" _upgrade_member":"")});d.setText(l.html())}var d=this;$.Ud.getProxy({field:["product.vipMember","product.plus.memberExpireTime"],call:c})}},$G.set("topNavConf",oTopNavConf,!0)}function e(){function b(){var a=$.Uri.getUrl("memberPayCss",!0),b=$.Uri.getUrl("memberPayJs",!0);$.Support.loadStyleSheet(a),$.Support.loadScript(b)}function c(){b(),$.Ajax.request({requestType:$.Ajax.XMLHTTP,url:"/fgw/gwAbInfo?uid="+$S("uid"),call:function(){var b=$.Cookie.get("gateAbtestInfo");try{if(b){var c=JSON.parse(b);if(c)try{a.mailStats.commonData.abtest_zone=c.abZone,a.mailStats.commonData.abtest_version=c.abVersion,a.MailStatsCountly.common_data.abtest_zone=c.abZone,a.MailStatsCountly.common_data.abtest_version=c.abVersion}catch(d){}}}catch(d){}}})}var d=$.getClass($N("init.Support")),e=$G.get("uriConf");e.free.memberPayCss=["https://mimg.127.net/p/tools/mailplus-sdk/payUmd-0.0.28.beta.5.css"],e.free.memberPayJs=["https://mimg.127.net/p/tools/mailplus-sdk/payUmd-0.0.28.beta.5.js"],d.loadMemberPayResource=c}function f(){var a=$.getClass($N("module.compose.ComposeAttach")),b=$S("isVip")||$S("isyeah")||$S("is126");a.sliceLength=b?1048576:196608}function g(){function a(a){a=a||{};var g=this,h={},i=a.type,j=a.path,k=a.name,l=a.mime,m=a.size,n=a.sid,o=a.eid;if(b.extend(h,d.file),i&&(h.type=i),j?(h.path=j,k||(k=j.replace(new RegExp(".*"+d.symbol),"")),g.fileGet({path:j}).length>=1&&(h.pathExist=!0)):k&&(k=k.replace(new RegExp(".*"+d.symbol),"")),k){h.name=k,h.icon=e.getSubtype({type:"file32",name:k});var p=k.split(".");if(p.length>1){var q=p.pop();q&&(q=q.toLowerCase(),h.ext=q,-1!=c.indexOf("."+q+".")&&(h.extLimit=!0))}}l&&(h.mime=l),"number"==typeof m&&(h.size=m,"storage"==i&&(h.bytesLoaded=m)),n&&(h.sid=n),o&&(h.eid=o),a.cloud&&(h.cloud=a.cloud);try{var r=(new Date).getTime();h.__uuid__=f.encode($S("uid")+r.toString()+h.name+h.size.toString())}catch(s){}return h}var b=$.Object;$.Browser,$.Ext;var c=$.EXTLIMIT;$.Log,$.S_OK,$.Ud,$.Uri;var d=$.getClass($N("module.compose.ComposeAttach")),e=$.getClass($N("util.Icon")),f=$.getClass($N("util.MD5"));d.prototype.fileCreate=a}function h(){function a(a,b,f,g){var h=this;"TIMEOUT"==b&&h.fileBreak(a);var i=d.t("未知错误"),j=d.t("，请重试"),k=!0,l=!1;switch(b){case"JS_EVAL":i=d.t("服务器返回格式错误")+j;break;case"JS_PLUGIN":i=d.t("插件版本过低，请使用标准添加附件方式选择大文件");break;case"NS_402":case"FA_INVALID_SESSION":i=d.t("登录超时，请重新登录邮箱"),$.Support.relogin();break;case"NS_415":i=d.t("超大附件服务器因网络问题已暂停上传，请手动重试");break;case"NS_514":i=d.t("系统不支持多次同时重复上传同一个文件");break;case"NS_515":case"FA_OVERFLOW":case"FA_UPLOAD_SIZE_EXCEEDED":"pref_smtp_max_send_mail_size"==f?i=d.t("附件大小超过限制"):"pref_flow_limit"==f?(i=d.t("附件流量超过限制"),$.Log.cache({Compose_NoGuide_Text_AttachmentUploadFlow:1})):i=d.t("附件大小或流量超过限制"),a&&a.cloud&&(i=d.t("超过超大附件空间上限，请您先删除已上传文件")),k=!1;break;case"NS_700":case"NS_701":case"NS_705":case"NS_710":i=d.t("此文件存在不良信息，禁止上传");break;case"FA_SECURITY":i=d.t("浏览器信息丢失，请重新登录邮箱");break;case"WX_DATA_ERROR":i=d.t("浏览器错误")+j,a.skipSplit=!0;break;case"JS_HTTP":case"AS_HTTP":i=0===f?d.t("服务器连接错误"):d.t("服务器")+f+d.t("错误"),i+=j;break;case"AS_ERROR":if(-1!=f.indexOf("Error #"))try{f=f.split("#")[1],f=f.split(":")[0],i="2038"==f?d.t("文件可能被其他程序占用"):"2049"==f?d.t("服务器响应错误"):"2032"==f?d.t("网络错误"):d.t("错误码")+f,i+=j}catch(m){}break;case"TIMEOUT":i=d.t("上传超时")+j,h.prompt({speed:!0});break;default:i=d.t("上传失败，错误码")+b+j}if(a.err=i,a.errCode=b,a.errReason=f,a){if(h.setLock(a,!1),"JS_HTTP"==b||"AS_HTTP"==b||"AS_ERROR"==b||"WX_DATA_ERROR"==b||"UX_UNKNOWN"==b){if(a.retry>e.UPLOAD_RETRY_MAX)c.cache({UploadFileFailALL:1});else if(l=!0,"check"==g?(0===a.retry&&c.cache({UploadFileFailFirst:1}),c.cache({ComposeAttachSkipUploadHost:{code:b,reason:f,type:g,host:a.upxmailUrl,fuuid:a.__uuid__}}),h.uploadHostSkip()):h.cloudTrigger()||"WX_DATA_ERROR"!=b&&a.retry<=e.UPLOAD_RETRY_MAX&&(c.cache({UploadFileFailFirst:1}),c.cache({ComposeAttachSkipUploadHost:{code:b,reason:f,type:g,host:a.upxmailUrl}}),h.uploadHostSkip()),a.retry==e.UPLOAD_RETRY_MAX&&0===a.offset){var n=h.fileSize();20971520>n&&h.data.set({status:"useWmsvr",value:!0})}a.retry++}if(!l){h.setState(a,"error",i);try{var o={uploadType:a.type,ext:a.ext,size:a.size,from:a.from,upxmailUrl:a.upxmailUrl,cloud:h.cloudTrigger(),fuuid:a.__uuid__};$.Log.cache({compose_attach_inlineerror_show:o})}catch(p){}}}else $.Msgbox.show({icon:"err",title:i});try{var q=encodeURIComponent(a.name),r={code:b,reason:f,upxmailUrl:a.upxmailUrl,type:g,size:a.size,retry:a.retry,agent:a.type,name:q,fuuid:a.__uuid__};c.cache({compose_attach_error:r})}catch(m){}return l||h.cancelAutoSend(d.t("附件上传失败，已为你取消了自动发送")),l}function b(a){var b=this,f=b.data,g=b.base;"<h4>"+d.t("您选择的文件不能上传，原因如下：")+"</h4>";var h="",i='<p style="font-weight: 500;font-size: 14px;line-height: 22px;color: #333333;">'+d.t("附件上传失败")+'</p><p style="height: 4px"></p>',j="",k="//help.mail.163.com/newfeedback.do?m=add",l="",m="",n="",o="",p=!1;$.Array.each(a,function(a,i){var q=i.name;$.String.len(q)>22&&(q=$.String.left(q,18));var r=i.err;if(e.errDescription[r]){if(r=e.errDescription[r],"limitBig"==i.err){var s=$.Number.convert($S("cloud").fileSizeLimit);r=d.t("超大附件单个文件大小超过")+s+d.t("限制"),n="Compose_Premium_Popup_LargeAttachmentLimit",c.cache({ComposeAttachSingleFileSizeOverLimit:i.size})}else"quotaBig"==i.err&&(n="Compose_Premium_Popup_LargeAttachmentLimitTotal");if("retryErrorBig"===i.err)n="Compose_Guide_Popup_CloudSvrAllFail",j='<p>建议您更换浏览器或刷新重试。如遇困难<a href="'+k+'">请反馈</a></p>';else if(f&&f.get({status:"vipMember"})){var t=i.err;if("limitBig"===t){var u=b.getAssistantHtml("Compose_LargeAttachmentLimit_Assistant_click");j='<p style="padding-top:8px;">'+d.t("若仍有疑问，可咨询会员专属")+u+"</p>"}else if("quotaBig"===t){var u=b.getAssistantHtml("Compose_StorageSpaceLimit_Assistant_click"),v=b.getStorageDetailHtml();j='<p style="padding-top:8px;">'+d.t("您可前往")+v+"，"+d.t("若仍有疑问，可咨询会员专属")+u+"</p>"}}else if(g.isNonPayingUser()){var t=i.err,w="",x="";switch(t){case"limitBig":w=d.t("立即开通邮箱会员，单个附件上限提至6G，更享超多会员权益"),l="LargeattachmentsTextLink",m="LargeattachmentsButton",o="cloudFileSizeLimit",x="b_mailAttach_cloudFileSizeLimit_click";break;case"quotaBig":w=d.t("立即开通邮箱会员，突破附件上传限制，更享超大邮箱容量空间>>"),l="ThestoragespaceTextLink",m="ThestoragespaceButton",o="mailCapacity",x="b_mailAttach_mailCapacity_click",n="Compose_Premium_Popup_LargeAttachmentLimitTotal"}w&&(p=!0,j='<p style="height:8px">&nbsp;</p>'+new $.Link({text:'<span style="font-size: 12px;line-height: 18px;color: #003399;">'+w+"</span>",click:function(){$E("product.Privileges",function(a){$.Msgbox.msgbox.close(),setTimeout(function(){a.showDialog(o,"",l);var b={};b[x]=1,$.Log.cache(b)},100)})}}).html())}}h+='<p><span title="'+i.name+'">'+q+"</span>"+'<span class="nui-txt-impt">('+r+")</span>"+"</p>"}),p?$.Msgbox.show({statsKey:n,statsValue:{plusMember:f.get({status:"vipMember"})},width:"500px",icon:"err",content:i+h+j,cancelText:d.t("取消"),okText:d.t("开通邮箱会员"),ok:function(){$E("product.Privileges",function(a){$.Msgbox.msgbox.close(),setTimeout(function(){a.showDialog(o,"",m);var b={};b[sLogKey]=1,$.Log.cache(b)},100)})}}):$.Msgbox.show({statsKey:n,statsValue:{plusMember:f.get({status:"vipMember"})},width:"500px",icon:"err",content:i+h+j})}$.Object,$.Browser,$.Ext,$.EXTLIMIT;var c=$.Log;$.S_OK,$.Ud,$.Uri;var d=new $I18N("module.compose.ComposeAttach"),e=$.getClass($N("module.compose.ComposeAttach"));e.prototype.error=a,e.prototype.filterFail=b}function i(){function a(a,b){var c=this,d=c.attach;if(c.getCheck(a)){var e=c.nativeGet(a);if(!e)return;e.withCredentials||(e.withCredentials=!0),e.onreadystatechange=function(){if(4==e.readyState)if(e.onreadystatechange=null,200==e.status){if(c.check(a,e.responseText)){c.fileUpload(a),c.netCheckSet(a);try{$.Log.cache({compose_native_uploadstart:{uploadType:a.type,ext:a.ext,size:a.size,from:a.from,upxmailUrl:a.upxmailUrl,cloud:c.cloudTrigger(),fuuid:a.__uuid__}})}catch(b){}}}else c.error(a,"JS_HTTP",e.status,"check")?c.nativeCheck(a,{code:"JS_HTTP",reason:e.status}):c.resum(a)};var f=c.getUploadProxy({type:"native",file:a,options:"body",check:!0},b);e.open($.Ajax.POST,f,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(a.options);try{$.Log.cache({compose_native_uploadcheck:{uploadType:a.type,ext:a.ext,size:a.size,from:a.from,upxmailUrl:a.upxmailUrl,cloud:c.cloudTrigger(),fuuid:a.__uuid__}})}catch(g){}}else{if(a.cloud)a.err="retryErrorBig",d.filterFail([a]);else{c.fileUpload(a);try{$.Log.cache({compose_native_uploadfile:{uploadType:a.type,ext:a.ext,size:a.size,from:a.from,upxmailUrl:a.upxmailUrl,cloud:c.cloudTrigger(),fuuid:a.__uuid__}})}catch(g){}}c.netCheckSet(a)}}function b(a,b){var e=$.getClass($N("module.compose.ComposeAttach")),f=this,g=f.nativeGet(a);if(g)if(g.withCredentials||(g.withCredentials=!0),g.upload&&(g.upload.onprogress=function(b){b.lengthComputable&&f.setBytes(a,b.loaded,b.total)}),g.onerror=function(){f.needValiServerBeforeSend(a),f.log("b_compose_attach_upload_error")},g.onabort=function(){f.needValiServerBeforeSend(a),f.log("b_compose_attach_upload_abort")},g.ontimeout=function(){f.needValiServerBeforeSend(a),f.log("b_compose_attach_upload_timeout")},g.onreadystatechange=function(){switch(g.readyState){case 1:f.setStart(a);break;case 2:f.setFinish(a);break;case 4:if(g.onreadystatechange=null,g.upload&&(g.upload.onprogress=null),f.netCheckClear(),a.blob)if(200==g.status){var b=f.complete(a,g.responseText);if(b.code==d)if(b["continue"])f.fileUpload(a),f.netCheckSet(a);else try{$.Log.cache({compose_native_uploadsuccess:{uploadType:a.type,ext:a.ext,size:a.size,from:a.from,upxmailUrl:a.upxmailUrl,cloud:f.cloudTrigger(),fuuid:a.__uuid__}})}catch(c){}else if(b.retry){var e={code:b.code};f.fileRetry(a,e)}else f.resum(a)}else if(a.abort)a.abort=!1;else if(f.error(a,"JS_HTTP",g.status,"upload")){var e={code:{code:"JS_HTTP",reason:g.status}};f.fileRetry(a,e)}else f.resum(a)}},f.getUploadHost()){var h=a.blob,i=!1;if((h.slice||h.mozSlice||h.webkitSlice)&&(i=!0),a.skipSplit)a.useSplit=!1,a.offset=0,a.length=0;else if(i){a.useSplit=!0,a.length=e.sliceLength,a.offset+a.length>a.size&&(a.length=a.size-a.offset);var j=a.offset+a.length;h.slice?h=h.slice(a.offset,j):h.mozSlice?h=h.mozSlice(a.offset,j):h.webkitSlice&&(h=h.webkitSlice(a.offset,j))}var k=f.getUploadProxy({type:"native",file:a,options:"header"},b);a.upxmailUrl=k,g.open($.Ajax.POST,k,!0),a.options&&c.each(a.options,function(a,b){g.setRequestHeader(a,b)}),g.setRequestHeader("Content-Type","application/octet-stream"),g.send(h)}else{if(g.open($.Ajax.POST,f.getUploadUrl({type:"native"}),!0),"undefined"!=typeof FormData)try{var l=new FormData;l.append("Filedata",a.blob,a.blob.name),g.send(l)}catch(m){}else if(a.blob.getAsBinary){var n=encodeURIComponent(a.name);n=n.replace(new RegExp("%(\\w{2})","ig"),function(a,b){return String.fromCharCode(parseInt(b,16))});var o="------neteasemailnativeupload"+(new Date).getTime(),p="--",q="\r\n",r=[];r.push(p,o,q),r.push('Content-Disposition: form-data; name="Filedata"; filename="',n,'"',q),r.push("Content-Type: application/octet-stream",q,q),r.push(a.blob.getAsBinary(),q),r.push(p,o,p,q),g.setRequestHeader("Content-Type","multipart/form-data; boundary="+o);try{var s=r.join("");g.sendAsBinary(s)}catch(m){}}$.Log.cache({compose_native_wmsvr_upload:""})}}var c=$.Object;$.Browser;var d=$.S_OK,e=$.getClass($N("module.compose.ComposeNative"));e.prototype.nativeCheck=a,e.prototype.fileUpload=b}function j(){var a=$.getClass($N("interface.ComposeInterface"));a.entry=function(a){$E("module.compose.ComposeManager",function(b){a&&!a.param&&"undefined"!=typeof a.type&&(a={type:a.type,param:{id:a.cid}}),b.entry(a)})}}function k(){function a(a){var c=this,f=c.data,g=c.info;c.tips("");var h=f.get({status:"sendParam"});if(f.get({status:"firstCloudFileSend"}),e.cache({ComposeSendSuccess:"save"==h.action}),$.Log.duration("performance_ir_compose","end"),"save"==h.action||"auto"==h.action||"force"==h.action||"continue"==h.action){if(g.set({obj:a["var"]}),a.draftId){g.set({did:a.draftId});var i={type:"draft",cid:a.draftId};location.replace("#module=compose.ComposeModule|"+encodeURIComponent(JSON.stringify(i)))}("save"==h.action||"force"==h.action)&&f.set({status:"existActiveDraft",value:!0}),c.changeSync();var j=$.Misc.getTime(0);("auto"==h.action||"save"==h.action)&&($.Tips.show({succ:!0,expire:0,text:b.t("邮件已于")+$.Date.format(j,"H:mm")+b.t("成功保存到草稿箱")}),c.trans({action:"check"})),"function"==typeof h.call&&c.addTimer("force",function(){h.call()})}else{c.clearTimer();var k=g.get({cid:!0});g.set({cid:""}),"verify"==h.action&&(h.action="deliver"),c.success.render(a,k),c.updateFirstCloudFileSend()}c.userDataRemove();try{var l=[2];"deliver"==h.action&&l.push(3),$.Listener.fire("compose:send",l),d.request(["Folder"])}catch(m){}f.set({status:"sendParam",value:null})}var b=new $I18N("module.compose.ComposeBase"),c=$.getClass($N("module.compose.ComposeBase")),d=$.getClass($N("init.Sync"));$.Object,$.Email,$.Ext;var e=$.Log;$.S_OK,$.Ud,$.Uri,c.prototype.sendSuccess=a}function l(){function a(){var a=this;a.data;var b=!1;$.Ud.getProxy({field:["product.vipMember","product.plus.member"],call:function(d){var e=d["product.vipMember"],f=d["product.plus.member"];if(b=e===!1||5>f){var g=c.t("您今天的发信数量已超过限制，请")+'<span style="color:#A38152;">'+(e?c.t("升级邮箱会员"):c.t("购买邮箱会员"))+"</span>"+c.t("以提升封数上限或明天再试。")+"<br/><br/>"+c.t("提示：群发时每位收件人都将消耗您的发信次数"),h=e?c.t("立即升级"):c.t("提升上限");$.Msgbox.show({statsKey:"Compose_Guide_Popup_SendQuotaFull_Upgrade",statsValue:{isMember:e,memberType:f},title:c.t("发信失败"),content:g,ok:function(){a.send({action:"save"}),$E("product.Privileges",function(a){e?a.upgrade({utm_source:"web_delivery_limit_upgrade"}):a.showProduct("","web_delivery_limit")})},okText:h,cancelText:c.t("我知道了")})}else $.Msgbox.show({statsKey:"Compose_Guide_Popup_SendQuotaFull",statsValue:{isMember:e,memberType:f},title:c.t("发信失败"),content:c.t("您今天的发信数量已超过限制，请明天再试。")+"<br/><br/>"+c.t("提示：群发时每位收件人都将消耗您的发信次数"),buttons:[{subclass:"mainBtn",text:c.t("我知道了"),click:function(){$.Msgbox.msgbox&&$.Msgbox.msgbox.close(),$.Log.cache({Compose_Guide_Popup_SendQuotaFull_OK:1})}}]});var i={ComposeQuotaOverflow:{isMember:e,memberType:f}};$.Log.cache(i)}})}function b(a){var b=this,d=b.data,f=b.info,g=b.attach,h=a.code,i=a["var"],j=$.getClass($N("module.compose.ComposeManager"));b.tips("");var k=d.get({status:"sendParam"});if(d.set({status:"sendParam",value:null}),"auto"==k.action)return"FA_ID_NOT_FOUND"===h&&d.set({status:"autoSave",value:!1}),!0;h==e&&("string"==typeof i?f.set({cid:i}):"object"==typeof a["var"]&&f.set({obj:i}));var l=j.error(a,k.action);if(b.isMailCapacityOverflow(l,a.code,a.overflowReason))return d.get({status:"vipMember"})||$S("isVip")?(l=c.t("邮箱容量已满，邮件无法保存为草稿，请尽快清理邮箱。"),b.showMailCapacityOverflowDialog(l,k.action),!0):(b.showMailCapacityOverflowDialog(l,k.action),!0);if(b.isMailSendQuotaOverflow(l,a.code,a.mtaCode)){if($S("isVip"))return b.showMailSendQuotaOverflowDialog(),!0;if(!$S("is163"))return b.showFreeMailSendQuotaOverflowDialog(),!0}if(l){if("FA_MTA_RCPT_ERROR"==l){var m,n=[];if(function(){var b,d=a.errorRcpts,e="",f=[];for(e in d)if("string"==typeof e&&-1!=e.indexOf("@")){if(d[e])switch(d[e]){case"MTA5104":b=c.t("帐号被停用");break;case"MTA5107":b=c.t("帐号不存在");break;case"MTA5101":b=c.t("由于管理员限制，您没有权限发送邮件给企业外的邮件地址");break;default:b=c.t("帐号被禁止")}else b=c.t("系统不允许");b='<label title="'+b+'">'+e+"</label>",f.push(b),n.push(e)}m=f.join("<br>")}(),m){var o=c.t("以下邮箱地址无效，将无法成功收到邮件"),p="";$.Msgbox.show({statsKey:"Compose_Guide_Popup_AddressInvalid",title:o,content:m+p,okText:c.t("发送邮件，忽略无效地址"),cancelText:c.t("返回编辑"),ok:function(){b.sendFixMta(n,!0)},cancel:function(){b.sendFixMta(n)}})}else $.Msgbox.show({statsKey:"Compose_NoGuide_Popup_AddressError",title:c.t("对不起，存在部分收件人无法收到信件！")});return!0}return l}switch(h){case"FA_INVALID_VERIFY_CODE":case"FA_NEED_VERIFY_CODE":var q=h.split("_")[1].toLowerCase();j.verify(q,function(a){b.send({action:"verify",code:a})});break;case"FA_ATTACH_NOT_COMPLETED":case"FA_ATTACH_CRC_FAILED":var r=a.badAttachment;if(r){var s=r.name||"";s=$.String.encodeHTML(s);var t=c.t("附件")+s+c.t("上传不完整，部分文件丢失，是否删除？");$.Msgbox.show({statsKey:"Compose_NoGuide_Popup_AttachmentNotCompleted",type:"confirm",header:c.t("附件校验出错"),title:t,ok:function(){b.action.deleteAttach({sid:r.id,callback:function(a){a.code==e||$.Msgbox.show({statsKey:"Compose_NoGuide_Popup_DeleteError",title:c.t("删除失败，请保存草稿后重新打开。")})}})}})}break;default:var u=g.fileGet({state:"success"});return"FA_ID_NOT_FOUND"===h&&d.set({status:"autoSave",value:!1}),u&&u.length?!1:(f.set({cid:""}),!1)}return!0}var c=new $I18N("module.compose.ComposeBase"),d=$.getClass($N("module.compose.ComposeBase"));$.Object,$.Email,$.Ext,$.Log;var e=$.S_OK;$.Ud,$.Uri,d.prototype.sendError=b,d.prototype.showFreeMailSendQuotaOverflowDialog=a}$Fix.fix=b}(window);